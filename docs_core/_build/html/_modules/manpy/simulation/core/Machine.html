<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" />

    <link rel="shortcut icon" href="../../../../_static/logo.png"/><!-- Generated with Sphinx 7.0.1 and Furo 2023.05.20 -->
        <title>manpy.simulation.core.Machine - Extended ManPy (beta) Docs</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo.css?digest=e6660623a769aa55fea372102b9bf3151b292993" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../../index.html"><div class="brand">Extended ManPy (beta) Docs</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Extended ManPy (beta) Docs</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../core.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../examples.html">Full examples</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for manpy.simulation.core.Machine</h1><div class="highlight"><pre>
<span></span><span class="c1"># ===========================================================================</span>
<span class="c1"># Copyright 2013 University of Limerick</span>
<span class="c1">#</span>
<span class="c1"># This file is part of DREAM.</span>
<span class="c1">#</span>
<span class="c1"># DREAM is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU Lesser General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># DREAM is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU Lesser General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
<span class="c1"># along with DREAM.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1"># ===========================================================================</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on 8 Nov 2012</span>

<span class="sd">@author: George</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># from SimPy.Simulation import Process, Resource, SimEvent</span>
<span class="c1"># from SimPy.Simulation import activate, passivate, waituntil, now, hold, request, release, waitevent</span>
<span class="kn">import</span> <span class="nn">simpy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">manpy.simulation.core.CoreObject</span> <span class="kn">import</span> <span class="n">CoreObject</span>

<span class="kn">from</span> <span class="nn">manpy.simulation.OperatorRouter</span> <span class="kn">import</span> <span class="n">Router</span>
<span class="kn">from</span> <span class="nn">manpy.simulation.SkilledOperatorRouter</span> <span class="kn">import</span> <span class="n">SkilledRouter</span>

<span class="kn">from</span> <span class="nn">manpy.simulation.OperatedPoolBroker</span> <span class="kn">import</span> <span class="n">Broker</span>
<span class="kn">from</span> <span class="nn">manpy.simulation.OperatorPool</span> <span class="kn">import</span> <span class="n">OperatorPool</span>

<span class="kn">from</span> <span class="nn">manpy.simulation.RandomNumberGenerator</span> <span class="kn">import</span> <span class="n">RandomNumberGenerator</span>

<span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>


<div class="viewcode-block" id="Machine"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine">[docs]</a><span class="k">class</span> <span class="nc">Machine</span><span class="p">(</span><span class="n">CoreObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Models a machine that can also have failures</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">family</span> <span class="o">=</span> <span class="s2">&quot;Server&quot;</span>

    <span class="c1"># =======================================================================</span>
    <span class="c1"># initialise the id the capacity, of the resource and the distribution</span>
    <span class="c1"># =======================================================================</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">id</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">capacity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">processingTime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">repairman</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
        <span class="n">operatorPool</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
        <span class="n">operationType</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
        <span class="n">setupTime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">loadTime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">preemption</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">canDeliverOnInterruption</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">technology</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">priority</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">control</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kw</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s2">&quot;Machine&quot;</span>  <span class="c1"># String that shows the type of object</span>
        <span class="n">CoreObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>

        <span class="n">processingTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOperationTime</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">processingTime</span><span class="p">)</span>

        <span class="n">setupTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOperationTime</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">setupTime</span><span class="p">)</span>

        <span class="n">loadTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOperationTime</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">loadTime</span><span class="p">)</span>

        <span class="c1">#     holds the capacity of the machine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span>
        <span class="c1">#     sets the repairman resource of the Machine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repairman</span> <span class="o">=</span> <span class="n">repairman</span>
        <span class="c1">#     Sets the attributes of the processing (and failure) time(s)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">RandomNumberGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processingTime</span><span class="p">)</span>
        <span class="c1"># check whether the operators are provided with a skills set</span>
        <span class="c1"># check whether the operators are provided with a skills set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dedicatedOperator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkForDedicatedOperators</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">operatorPool</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">operatorPool</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">=</span> <span class="n">operatorPool</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">OperatorPoolsList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="p">(</span>
                    <span class="n">operatorPool</span>
                <span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">OperatorPoolsList</span>
                <span class="p">):</span>  <span class="c1"># find the operatorPool assigned to the machine</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">operatorPool</span><span class="o">.</span><span class="n">coreObjectIds</span>
                    <span class="p">):</span>  <span class="c1"># and add it to the machine&#39;s operatorPool</span>
                        <span class="n">machineOperatorPoolList</span> <span class="o">=</span> <span class="n">operatorPool</span>  <span class="c1"># there must only one operator pool assigned to the machine,</span>
                        <span class="c1"># otherwise only one of them will be taken into account</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">machineOperatorPoolList</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="p">[]</span>
                        <span class="p">)</span>  <span class="c1"># if there is no operatorPool assigned to the machine</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># then machineOperatorPoolList/operatorPool is a list</span>
                <span class="n">machineOperatorPoolList</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">[]</span>
                <span class="p">)</span>  <span class="c1"># if there are no operatorsPool created then the</span>
                <span class="c1"># then machineOperatorPoolList/operatorPool is a list</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">machineOperatorPoolList</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span>
            <span class="p">):</span>  <span class="c1"># if the machineOperatorPoolList is a list</span>
                <span class="c1"># find the operators assigned to it and add them to the list</span>
                <span class="k">for</span> <span class="p">(</span>
                    <span class="n">operator</span>
                <span class="p">)</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">OperatorsList</span><span class="p">:</span>  <span class="c1"># check which operator in the G.OperatorsList</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">operator</span><span class="o">.</span><span class="n">coreObjectIds</span>
                    <span class="p">):</span>  <span class="c1"># (if any) is assigned to operate</span>
                        <span class="n">machineOperatorPoolList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">operator</span>
                        <span class="p">)</span>  <span class="c1"># the machine with ID equal to id</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">=</span> <span class="n">machineOperatorPoolList</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dedicatedOperator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkForDedicatedOperators</span><span class="p">()</span>
        <span class="c1"># create an operatorPool if needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createOperatorPool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="p">)</span>
        <span class="c1"># holds the Operator currently processing the Machine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># define if load/setup/removal/processing are performed by the operator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operationType</span> <span class="o">=</span> <span class="n">operationType</span>
        <span class="c1"># boolean to check whether the machine is being operated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toBeOperated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># define the load times</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadRng</span> <span class="o">=</span> <span class="n">RandomNumberGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loadTime</span><span class="p">)</span>
        <span class="c1"># XX variable that informs on the need for setup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># define the setup times</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stpRng</span> <span class="o">=</span> <span class="n">RandomNumberGenerator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setupTime</span><span class="p">)</span>
        <span class="c1"># examine if there are multiple operation types performed by the operator</span>
        <span class="c1">#     there can be Setup/Processing operationType</span>
        <span class="c1">#     or the combination of both (MT-Load-Setup-Processing)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multOperationTypeList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operationType</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">operationType</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;MT&quot;</span><span class="p">):</span>
            <span class="n">OTlist</span> <span class="o">=</span> <span class="n">operationType</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operationType</span> <span class="o">=</span> <span class="n">OTlist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multOperationTypeList</span> <span class="o">=</span> <span class="n">OTlist</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multOperationTypeList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operationType</span><span class="p">)</span>
        <span class="c1"># technology is used to group machines that perform the same operation when needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">technology</span> <span class="o">=</span> <span class="n">technology</span>

        <span class="c1"># flags used for preemption purposes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isPreemptive</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetOnPreemption</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">preemption</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isPreemptive</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">preemption</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;isPreemptive&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resetOnPreemption</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">preemption</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resetOnPreemption&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
        <span class="c1"># flag notifying that there is operator assigned to the actievObject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignedOperator</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># flag notifying the the station can deliver entities that ended their processing while interrupted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canDeliverOnInterruption</span> <span class="o">=</span> <span class="n">canDeliverOnInterruption</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repairman</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">repairman</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">RepairmanList</span><span class="p">:</span>  <span class="c1"># check which repairman in the G.RepairmanList</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">repairman</span><span class="o">.</span><span class="n">coreObjectIds</span><span class="p">:</span>  <span class="c1"># (if any) is assigned to repair</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repairman</span> <span class="o">=</span> <span class="n">repairman</span>  <span class="c1"># the machine with ID equal to id</span>
        <span class="n">G</span><span class="o">.</span><span class="n">MachineList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># add machine to global MachineList</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="n">G</span><span class="o">.</span><span class="n">OperatedMachineList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span>
            <span class="p">)</span>  <span class="c1"># add the machine to the operatedMachines List</span>
        <span class="c1"># attribute to prioritize against competing parallel machines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">priority</span> <span class="o">=</span> <span class="n">priority</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processed_entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># set a default function for control if none is defined</span>
        <span class="k">if</span> <span class="n">control</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">condition</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">control</span>

        <span class="c1"># list for Entities who fail control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discards</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># list for finished Entities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># if currently operating</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operationNotFinished</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Machine.initialize"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.initialize">[docs]</a>    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;initializes the machine&quot;&quot;&quot;</span>

        <span class="c1"># using the Process __init__ and not the CoreObject __init__</span>
        <span class="n">CoreObject</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># initialize the internal Queue (type Resource) of the Machine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Res</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">capacity</span><span class="p">)</span>
        <span class="c1"># initiate the Broker and the router</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createBroker</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createRouter</span><span class="p">()</span>
        <span class="c1"># initialize the operator pool if any</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializeOperatorPool</span><span class="p">()</span>
        <span class="c1"># initiate the Broker responsible to control the request/release</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializeBroker</span><span class="p">()</span>
        <span class="c1"># initialise the router if not initialized already</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializeRouter</span><span class="p">()</span>

        <span class="c1"># variables used for interruptions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isProcessing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># variable that shows what kind of operation is the station performing at the moment</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            it can be Processing or Setup</span>
<span class="sd">            XXX: others not yet implemented</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentlyPerforming</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tinM</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLastProcessingStarted</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLastOperationStarted</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interruption</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breakTime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># flag notifying that there is operator assigned to the actievObject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignedOperator</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">brokerIsSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
        <span class="c1"># this event is generated every time an operator is requested by machine for Load operation type.</span>
        <span class="c1">#     if the machine has not succeeded in getting an entity due to the resource absence</span>
        <span class="c1">#     and waits for the next event to get the entity,</span>
        <span class="c1">#     then it must be signalled that the operator is now available</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadOperatorAvailable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
        <span class="c1"># signal used for preemption</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preemptQueue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
        <span class="c1"># signal used for informing objectInterruption objects that the current entity processed has finished processing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endedLastProcessing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
        <span class="c1"># signal used for waiting for ObjectProperties to end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objectPropertyEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;isRequested&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;interruptionEnd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;loadOperatorAvailable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;initialWIP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># events about the availability of process operator</span>
        <span class="c1"># TODO group those operator relate events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processOperatorUnavailable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
        <span class="c1"># holds the Operator currently processing the Machine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Machine.getOperationTime"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.getOperationTime">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">getOperationTime</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
        <span class="c1"># XXX update time to comply with old definition</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns the dictionary updated&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">time</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Fixed&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}</span>
        <span class="k">if</span> <span class="s2">&quot;Normal&quot;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="ow">and</span> <span class="n">time</span><span class="p">[</span><span class="s2">&quot;Normal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time</span><span class="p">[</span><span class="s2">&quot;Normal&quot;</span><span class="p">][</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="s2">&quot;Normal&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span>
                <span class="n">time</span><span class="p">[</span><span class="s2">&quot;Normal&quot;</span><span class="p">][</span><span class="s2">&quot;stdev&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">time</span></div>

<div class="viewcode-block" id="Machine.createOperatorPool"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.createOperatorPool">[docs]</a>    <span class="k">def</span> <span class="nf">createOperatorPool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operatorPool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;create an operatorPool if needed&quot;&quot;&quot;</span>

        <span class="c1"># sets the operator resource of the Machine</span>
        <span class="c1"># check if the operatorPool is a List or a OperatorPool type Object</span>
        <span class="c1"># if it is a list then initiate a OperatorPool type object containing</span>
        <span class="c1"># the list of operators provided</span>
        <span class="c1"># if the  list is empty create operator pool with empty list</span>

        <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>

        <span class="c1"># XXX operatorPool is not None ?</span>
        <span class="c1"># if a list of operators is provided as argument</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">operatorPool</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">operatorPool</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;_OP&quot;</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objName</span> <span class="o">+</span> <span class="s2">&quot;_operatorPool&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">=</span> <span class="n">OperatorPool</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">operatorsList</span><span class="o">=</span><span class="n">operatorPool</span><span class="p">)</span>
            <span class="n">G</span><span class="o">.</span><span class="n">OperatorPoolsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="p">)</span>
        <span class="c1"># if an operatorPool object is connected to the machine</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">operatorPool</span><span class="p">)</span> <span class="ow">is</span> <span class="n">OperatorPool</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">=</span> <span class="n">operatorPool</span>
        <span class="c1"># otherwise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if there are operators with skillList</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dedicatedOperator</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;_OP&quot;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objName</span> <span class="o">+</span> <span class="s2">&quot;_operatorPool&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">=</span> <span class="n">OperatorPool</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">operatorsList</span><span class="o">=</span><span class="p">[])</span>
                <span class="n">G</span><span class="o">.</span><span class="n">OperatorPoolsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="p">)</span>
            <span class="c1"># otherwise create no operatorPool</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="c1"># update the operatorPool coreObjects list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="o">.</span><span class="n">coreObjectIds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="o">.</span><span class="n">coreObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Machine.createBroker"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.createBroker">[docs]</a>    <span class="k">def</span> <span class="nf">createBroker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;create broker if needed&quot;&quot;&quot;</span>

        <span class="c1"># initiate the Broker and the router</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">broker</span> <span class="o">=</span> <span class="n">Broker</span><span class="p">(</span><span class="n">operatedMachine</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Machine.createRouter"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.createRouter">[docs]</a>    <span class="k">def</span> <span class="nf">createRouter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;create router if needed&quot;&quot;&quot;</span>

        <span class="c1"># initiate the Broker and the router</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>

            <span class="c1"># if there is no router</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">:</span>
                <span class="c1"># TODO if the dedicatedOperator flag is raised then create a SkilledRouter (temp)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dedicatedOperator</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">router</span> <span class="o">=</span> <span class="n">SkilledRouter</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">router</span> <span class="o">=</span> <span class="n">Router</span><span class="p">()</span>
                <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">router</span>
            <span class="c1"># otherwise set the already existing router as the machines Router</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">router</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Machine.initializeOperatorPool"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.initializeOperatorPool">[docs]</a>    <span class="k">def</span> <span class="nf">initializeOperatorPool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;initialise broker if needed&quot;&quot;&quot;</span>

        <span class="c1"># initialise the operator pool if any</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
            <span class="c1"># if the flag dedicatedOperator is true then reset/empty the operators list of the pool</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dedicatedOperator</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="o">.</span><span class="n">operators</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># otherwise update the coreObjectIds/coreObjects list of the operators</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">operator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="o">.</span><span class="n">operators</span><span class="p">:</span>
                    <span class="n">operator</span><span class="o">.</span><span class="n">coreObjectIds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="n">operator</span><span class="o">.</span><span class="n">coreObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Machine.initializeBroker"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.initializeBroker">[docs]</a>    <span class="k">def</span> <span class="nf">initializeBroker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;initialise broker if needed&quot;&quot;&quot;</span>

        <span class="c1"># initiate the Broker responsible to control the request/release</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">run</span><span class="p">())</span></div>

<div class="viewcode-block" id="Machine.initializeRouter"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.initializeRouter">[docs]</a>    <span class="k">def</span> <span class="nf">initializeRouter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;initialise router if needed&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="c1"># initialise the router only once</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">isInitialized</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">isActivated</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">run</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">isActivated</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1"># ===========================================================================</span>
    <span class="c1"># get the initial operationTypes (setup/processing) : manual or automatic</span>
    <span class="c1"># ===========================================================================</span>
    <span class="k">def</span> <span class="nf">checkInitialOperationTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># ===========================================================================</span>
    <span class="c1"># get the initial operation times (setup/processing);</span>
    <span class="c1"># XXX initialy only setup time is calculated here</span>
    <span class="c1"># ===========================================================================</span>
    <span class="k">def</span> <span class="nf">calculateInitialOperationTimes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="Machine.shouldYield"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.shouldYield">[docs]</a>    <span class="k">def</span> <span class="nf">shouldYield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operationTypes</span><span class="o">=</span><span class="p">{},</span> <span class="n">methods</span><span class="o">=</span><span class="p">{}):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;method controlling if there is a need to yield&quot;&quot;&quot;</span>

        <span class="c1"># Method that controls if the machine should yield for releasing the operator</span>
        <span class="c1"># &quot;methods&quot;:{&#39;isInterrupted&#39;:&#39;0&#39;},                                % the method isInterrupted should return False (0) or True (1)</span>
        <span class="c1"># &quot;operationTypes&quot;={&quot;Processing&quot;:1,                               % processing must be in multiOperationTypeList</span>
        <span class="c1">#                    &quot;Setup&quot;:0                                    % setup must not be in multiOperationTypeList</span>
        <span class="c1">#              }</span>
        <span class="n">operationsRequired</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">operationsNotRequired</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">opRequest</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">operationTypes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">operationType</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">operationTypes</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="n">operationType</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
                    <span class="n">operationsRequired</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">operationsNotRequired</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
            <span class="n">required</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># operations that should be in the multOperationTypeList</span>
            <span class="k">if</span> <span class="n">operationsRequired</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">opTup</span> <span class="ow">in</span> <span class="n">operationsRequired</span><span class="p">:</span>
                    <span class="n">operation</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">opTup</span>
                    <span class="n">required</span> <span class="o">=</span> <span class="n">required</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="nb">any</span><span class="p">(</span>
                            <span class="nb">type</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
                            <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">multOperationTypeList</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">notRequired</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># operations that should NOT be in the multOperationTypeList</span>
            <span class="k">if</span> <span class="n">operationsNotRequired</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">opTup</span> <span class="ow">in</span> <span class="n">operationsNotRequired</span><span class="p">:</span>
                    <span class="n">operation</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">opTup</span>
                    <span class="n">notRequired</span> <span class="o">=</span> <span class="n">notRequired</span> <span class="ow">or</span> <span class="p">(</span>
                        <span class="nb">any</span><span class="p">(</span>
                            <span class="nb">type</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
                            <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">multOperationTypeList</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
            <span class="n">opRequest</span> <span class="o">=</span> <span class="n">required</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">notRequired</span>

        <span class="n">methodsRequired</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">methodsNotRequired</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">methodsRequest</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">methods</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">methodType</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">methods</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="n">methodType</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
                    <span class="n">methodsRequired</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">methodsNotRequired</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tup</span><span class="p">)</span>
            <span class="c1"># methods that should return TRUE</span>
            <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">getMethodFromName</span>

            <span class="k">if</span> <span class="n">methodsRequired</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">methodTup</span> <span class="ow">in</span> <span class="n">methodsRequired</span><span class="p">:</span>
                    <span class="n">method</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">methodTup</span>
                    <span class="n">objMethod</span> <span class="o">=</span> <span class="n">getMethodFromName</span><span class="p">(</span><span class="s2">&quot;manpy.core.Machine.&quot;</span> <span class="o">+</span> <span class="n">method</span><span class="p">)</span>
                    <span class="n">required</span> <span class="o">=</span> <span class="n">required</span> <span class="ow">and</span> <span class="p">(</span><span class="n">objMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="c1"># methods that should return FALSE</span>
            <span class="n">notRequired</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">methodsNotRequired</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">methodTup</span> <span class="ow">in</span> <span class="n">methodsNotRequired</span><span class="p">:</span>
                    <span class="n">method</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">methodTup</span>
                    <span class="n">objMethod</span> <span class="o">=</span> <span class="n">getMethodFromName</span><span class="p">(</span><span class="s2">&quot;manpy.core.Machine.&quot;</span> <span class="o">+</span> <span class="n">method</span><span class="p">)</span>
                    <span class="n">notRequired</span> <span class="o">=</span> <span class="n">notRequired</span> <span class="ow">and</span> <span class="p">(</span><span class="n">objMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">notRequired</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">methodsRequest</span> <span class="o">=</span> <span class="n">required</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">notRequired</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">opRequest</span> <span class="ow">and</span> <span class="n">methodsRequest</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Machine.release"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.release">[docs]</a>    <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;yielding the broker process for releasing the resource&quot;&quot;&quot;</span>

        <span class="c1"># after getting the entity release the operator</span>
        <span class="c1"># machine has to release the operator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">releaseOperator</span><span class="p">()</span>
        <span class="c1"># wait until the Broker has finished processing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;brokerIsSet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">brokerIsSet</span>
        <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brokerIsSet</span><span class="o">.</span><span class="n">value</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">transmitter</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span>
        <span class="p">),</span> <span class="s2">&quot;brokerIsSet is not sent by the stations broker&quot;</span>
        <span class="k">assert</span> <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s2">&quot;brokerIsSet is not received on time&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brokerIsSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span></div>

<div class="viewcode-block" id="Machine.request"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.request">[docs]</a>    <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;yielding the broker process for requesting an operator&quot;&quot;&quot;</span>

        <span class="c1"># when it&#39;s ready to accept (canAcceptAndIsRequested) then inform the broker</span>
        <span class="c1"># machines waits to be operated (waits for the operator)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requestOperator</span><span class="p">()</span>
        <span class="c1"># wait until the Broker has waited times equal to loadTime (if any)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;brokerIsSet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">brokerIsSet</span>
        <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brokerIsSet</span><span class="o">.</span><span class="n">value</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">transmitter</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">broker</span>
        <span class="p">),</span> <span class="s2">&quot;brokerIsSet is not sent by the stations broker&quot;</span>
        <span class="k">assert</span> <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s2">&quot;brokerIsSet is not received on time&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brokerIsSet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span></div>

<div class="viewcode-block" id="Machine.operation"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.operation">[docs]</a>    <span class="k">def</span> <span class="nf">operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Processing&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;general process, it can be processing or setup&quot;&quot;&quot;</span>

        <span class="c1"># assert that the type is not None and is one of the already implemented ones</span>
        <span class="k">assert</span> <span class="nb">type</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;there must be an operation type defined&quot;</span>
        <span class="k">assert</span> <span class="nb">type</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;Processing&quot;</span><span class="p">,</span> <span class="s2">&quot;Setup&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;the operation type provided is not yet defined&quot;</span>
        <span class="c1"># identify the method to get the operation time and initialise the totalOperationTime</span>

        <span class="n">activeObjectQueue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Res</span><span class="o">.</span><span class="n">users</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activeEntity</span> <span class="o">=</span> <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Setup&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">totalOperationTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalSetupTime</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Processing&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">totalOperationTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalWorkingTime</span>
            <span class="c1"># if there are task_ids defined for each step</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentEntity</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="c1"># if exit Time is defined for the previous step of the schedule then add a new step for processing (the previous step is setup and is concluded)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentEntity</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exitTime&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="c1"># define a new schedule step for processing</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">currentEntity</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;station&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">,</span>
                            <span class="s2">&quot;entranceTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span>
                            <span class="s2">&quot;task_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentEntity</span><span class="o">.</span><span class="n">currentStep</span><span class="p">[</span><span class="s2">&quot;task_id&quot;</span><span class="p">],</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
            <span class="c1"># variables dedicated to hold the processing times, the time when the Entity entered,</span>
            <span class="c1"># and the processing time left</span>
            <span class="c1"># get the operation time, tinMStarts holds the processing time of the machine</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">totalOperationTimeInCurrentEntity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateTime</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Processing&quot;</span><span class="p">)</span>
            <span class="c1"># timer to hold the operation time left</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tinM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalOperationTimeInCurrentEntity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timeToEndCurrentOperation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tinM</span>
            <span class="c1"># variables used to flag any interruptions and the end of the processing</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interruption</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># local variable that is used to check whether the operation is concluded</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operationNotFinished</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># if there is a failure that depends on the working time of the Machine</span>
            <span class="c1"># send it the victimStartsProcess signal</span>
            <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectInterruptions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Failure&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">deteriorationType</span> <span class="o">==</span> <span class="s2">&quot;working&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;victimStartsProcessing&quot;</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sendSignal</span><span class="p">(</span><span class="n">receiver</span><span class="o">=</span><span class="n">oi</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">oi</span><span class="o">.</span><span class="n">victimStartsProcessing</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectProperties</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;victimStartsProcessing&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sendSignal</span><span class="p">(</span><span class="n">receiver</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">victimStartsProcessing</span><span class="p">)</span>

            <span class="c1"># this loop is repeated until the processing time is expired with no failure</span>
            <span class="c1"># check when the processingEndedFlag switched to false</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">operationNotFinished</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;interruptionStart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;preemptQueue&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;processOperatorUnavailable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="c1"># dummy variable to keep track of the time that the operation starts after every interruption</span>

                <span class="c1"># update timeLastOperationStarted both for Machine and Operator (if any)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeLastOperationStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="o">.</span><span class="n">timeLastOperationStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="c1">#             # if the type is setup then the time to record is timeLastProcessingStarted</span>
                <span class="c1">#             if type==&#39;Setup&#39;:</span>
                <span class="c1">#                 self.timeLastSetupStarted=self.timeLastOperationStarted</span>
                <span class="c1">#             # else if the type is processing then the time to record is timeLastProcessingStarted</span>
                <span class="c1">#             elif type==&#39;Processing&#39;:</span>
                <span class="c1">#                 self.timeLastProcessingStarted=self.timeLastOperationStarted</span>
                <span class="c1"># processing starts, update the flags</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isProcessing</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currentlyPerforming</span> <span class="o">=</span> <span class="nb">type</span>
                <span class="c1"># wait for the processing time left tinM, if no interruption occurs then change the processingEndedFlag and exit loop,</span>
                <span class="c1">#     else (if interrupted()) set interruption flag to true (only if tinM==0),</span>
                <span class="c1">#     and recalculate the processing time left tinM, passivate while waiting for repair.</span>
                <span class="c1"># if a preemption has occurred then react accordingly (proceed with getting the critical entity)</span>
                <span class="n">receivedEvent</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">any_of</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interruptionStart</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tinM</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">preemptQueue</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">processOperatorUnavailable</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="c1"># if a failure occurs while processing the machine is interrupted.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionStart</span> <span class="ow">in</span> <span class="n">receivedEvent</span><span class="p">:</span>
                    <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionStart</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                    <span class="p">),</span> <span class="s2">&quot;the interruption has not been processed on the time of activation&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interruptionStart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interruptionActions</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>  <span class="c1"># execute interruption actions</span>
                    <span class="c1"># ===========================================================</span>
                    <span class="c1"># # release the operator if there is interruption</span>
                    <span class="c1"># ===========================================================</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shouldYield</span><span class="p">(</span>
                        <span class="n">operationTypes</span><span class="o">=</span><span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span> <span class="mi">1</span><span class="p">},</span> <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;isOperated&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
                    <span class="p">):</span>
                        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">())</span>
                    <span class="c1"># loop until we reach at a state that there is no interruption</span>
                    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;interruptionEnd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span>  <span class="c1"># interruptionEnd to be triggered by ObjectInterruption</span>
                        <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span><span class="o">.</span><span class="n">value</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                        <span class="p">),</span> <span class="s2">&quot;the interruptionEnd was received later than anticipated&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">postInterruptionActions</span><span class="p">()</span>  <span class="c1"># execute interruption actions</span>
                        <span class="c1"># check if the machine is active and break</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkIfActive</span><span class="p">():</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shouldYield</span><span class="p">(</span>
                                <span class="n">operationTypes</span><span class="o">=</span><span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span> <span class="mi">1</span><span class="p">},</span> <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;isInterrupted&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                            <span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">())</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">operatorWaitTimeCurrentEntity</span> <span class="o">+=</span> <span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorEnded</span>
                                    <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorStarted</span>
                                <span class="p">)</span>
                            <span class="k">break</span>
                        <span class="c1"># ===========================================================</span>
                        <span class="c1"># # request a resource after the repair</span>
                        <span class="c1"># ===========================================================</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shouldYield</span><span class="p">(</span>
                            <span class="n">operationTypes</span><span class="o">=</span><span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span> <span class="mi">1</span><span class="p">},</span> <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;isInterrupted&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">())</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">operatorWaitTimeCurrentEntity</span> <span class="o">+=</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorEnded</span>
                                <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorStarted</span>
                            <span class="p">)</span>

                <span class="c1"># if the processing operator left</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">processOperatorUnavailable</span> <span class="ow">in</span> <span class="n">receivedEvent</span><span class="p">:</span>
                    <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processOperatorUnavailable</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">==</span> <span class="n">eventTime</span>
                    <span class="p">),</span> <span class="s2">&quot;the operator leaving has not been processed at the time it should&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">processOperatorUnavailable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                    <span class="c1"># carry interruption actions</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interruptionActions</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
                    <span class="c1"># ===========================================================</span>
                    <span class="c1"># # release the operator</span>
                    <span class="c1"># ===========================================================</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="o">.</span><span class="n">totalWorkingTime</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="o">.</span><span class="n">timeLastOperationStarted</span>
                    <span class="p">)</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">())</span>
                    <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>

                    <span class="c1"># append the entity that was stopped to the pending ones</span>
                    <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">:</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">pendingEntities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentEntity</span><span class="p">)</span>
                    <span class="c1"># ===========================================================</span>
                    <span class="c1"># # request a resource after the interruption</span>
                    <span class="c1"># ===========================================================</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">operatorWaitTimeCurrentEntity</span> <span class="o">+=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorEnded</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorStarted</span>
                    <span class="p">)</span>
                    <span class="c1"># carry post interruption actions</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">postInterruptionActions</span><span class="p">()</span>

                <span class="c1"># if the station is reactivated by the preempt method</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shouldPreempt</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preemptQueue</span> <span class="ow">in</span> <span class="n">receivedEvent</span><span class="p">:</span>
                        <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preemptQueue</span><span class="o">.</span><span class="n">value</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                        <span class="p">),</span> <span class="s2">&quot;the preemption must be performed on the time of request&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">preemptQueue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interruptionActions</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>  <span class="c1"># execute interruption actions</span>
                    <span class="c1"># ===========================================================</span>
                    <span class="c1"># # release the operator if there is interruption</span>
                    <span class="c1"># ===========================================================</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shouldYield</span><span class="p">(</span>
                        <span class="n">operationTypes</span><span class="o">=</span><span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentlyPerforming</span><span class="p">):</span> <span class="mi">1</span><span class="p">},</span>
                        <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;isOperated&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                    <span class="p">):</span>
                        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">postInterruptionActions</span><span class="p">()</span>  <span class="c1"># execute interruption actions</span>
                    <span class="k">break</span>
                <span class="c1"># if no interruption occurred the processing in M1 is ended</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processOperatorUnavailable</span><span class="o">.</span><span class="n">triggered</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">processOperatorUnavailable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">operationNotFinished</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Machine.run"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;the main process of the machine&quot;&quot;&quot;</span>

        <span class="c1"># request for allocation if needed</span>
        <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initialAllocationRequest</span><span class="p">()</span>
        <span class="c1"># execute all through simulation time</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># waitEvent isRequested /interruptionEnd/loadOperatorAvailable</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printTrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">waitEvent</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;isRequested&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;interruptionEnd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;loadOperatorAvailable&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;initialWIP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="n">receivedEvent</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">any_of</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">isRequested</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">loadOperatorAvailable</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">initialWIP</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printTrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">received</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="c1"># if the machine can accept an entity and one predecessor requests it continue with receiving the entity</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRequested</span> <span class="ow">in</span> <span class="n">receivedEvent</span><span class="p">:</span>
                    <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRequested</span><span class="o">.</span><span class="n">value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">printTrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">isRequested</span><span class="o">=</span><span class="n">transmitter</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="k">assert</span> <span class="n">eventTime</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;isRequested was triggered earlier, not now. Event time: </span><span class="si">{</span><span class="n">eventTime</span><span class="si">}</span><span class="s2">, Now: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2">, &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Id: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">, transmitter: </span><span class="si">{</span><span class="n">transmitter</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">transmitter</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">giver</span>
                    <span class="p">),</span> <span class="s2">&quot;the giver is not the requestingObject&quot;</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">giver</span><span class="o">.</span><span class="n">receiver</span> <span class="o">==</span> <span class="bp">self</span>
                    <span class="p">),</span> <span class="s2">&quot;the receiver of the signalling object in not the station&quot;</span>
                    <span class="c1"># reset the signalparam of the isRequested event</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">isRequested</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                    <span class="k">break</span>
                <span class="c1"># if an interruption caused the control to be taken by the machine or</span>
                <span class="c1"># if an operator was rendered available while it was needed by the machine to proceed with getEntity</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span> <span class="ow">in</span> <span class="n">receivedEvent</span>
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadOperatorAvailable</span> <span class="ow">in</span> <span class="n">receivedEvent</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span> <span class="ow">in</span> <span class="n">receivedEvent</span><span class="p">:</span>
                        <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span><span class="o">.</span><span class="n">value</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                        <span class="p">),</span> <span class="s2">&quot;interruptionEnd received later than created&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">printTrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">interruptionEnd</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">eventTime</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                        <span class="c1"># try to signal the Giver, otherwise wait until it is requested</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalGiver</span><span class="p">():</span>
                            <span class="c1"># XXX cleaner implementation needed</span>
                            <span class="c1"># if there is skilled router the giver should also check</span>
                            <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">:</span>
                                <span class="k">if</span> <span class="s2">&quot;Skilled&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                                    <span class="k">continue</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadOperatorAvailable</span> <span class="ow">in</span> <span class="n">receivedEvent</span><span class="p">:</span>
                        <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadOperatorAvailable</span><span class="o">.</span><span class="n">value</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                        <span class="p">),</span> <span class="s2">&quot;loadOperatorAvailable received later than created&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">printTrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">loadOperatorAvailable</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">eventTime</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">loadOperatorAvailable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                        <span class="c1"># try to signal the Giver, otherwise wait until it is requested</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalGiver</span><span class="p">():</span>
                            <span class="c1"># XXX cleaner implementation needed</span>
                            <span class="c1"># if there is router that is not skilled break</span>
                            <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">:</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;Skilled&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                                    <span class="k">break</span>
                            <span class="c1"># else continue, the giver should also check</span>
                            <span class="k">continue</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialWIP</span> <span class="ow">in</span> <span class="n">receivedEvent</span><span class="p">:</span>
                    <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialWIP</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">transmitter</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span>
                    <span class="p">),</span> <span class="s2">&quot;initialWIP was not sent by the Environment&quot;</span>
                    <span class="k">assert</span> <span class="p">(</span>
                        <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                    <span class="p">),</span> <span class="s2">&quot;initialWIP was not received on time&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">initialWIP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">isProcessingInitialWIP</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkIfActive</span><span class="p">():</span>
                        <span class="k">continue</span>
                    <span class="k">break</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isProcessingInitialWIP</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="c1"># TODO: maybe here have to assigneExit of the giver and add self to operator activeCallers list</span>

            <span class="c1"># here or in the getEntity (apart from the loadTimeCurrentEntity)</span>
            <span class="c1"># in case they are placed inside the getEntity then the initialize of</span>
            <span class="c1"># the corresponding variables should be moved to the initialize() of the CoreObject</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">operatorWaitTimeCurrentEntity</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadOperatorWaitTimeCurrentEntity</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadTimeCurrentEntity</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setupTimeCurrentEntity</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># #  request a resource if there is a need for load operation</span>
            <span class="c1"># ===================================================================</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shouldYield</span><span class="p">(</span><span class="n">operationTypes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Load&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isProcessingInitialWIP</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForLoadOperatorStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForLoadOperatorEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadOperatorWaitTimeCurrentEntity</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForLoadOperatorEnded</span>
                    <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForLoadOperatorStarted</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">totalTimeWaitingForLoadOperator</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadOperatorWaitTimeCurrentEntity</span>
                <span class="p">)</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># # # loading</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>

            <span class="c1"># ======= Load the machine if the Load is defined as one of the Operators&#39; operation types</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">any</span><span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Load&quot;</span> <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">multOperationTypeList</span><span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isOperated</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeLoadStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calculateTime</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Load&quot;</span><span class="p">))</span>
                <span class="c1"># TODO: if self.interrupted(): There is the issue of failure during the Loading</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeLoadEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadTimeCurrentEntity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeLoadEnded</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeLoadStarted</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">totalLoadTime</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadTimeCurrentEntity</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># # # end loading</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># # # getting entity</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>

            <span class="c1"># get the entity</span>
            <span class="c1"># TODO: if there was loading time then we must solve the problem of getting an entity</span>
            <span class="c1"># from an unidentified giver or not getting an entity at all as the giver</span>
            <span class="c1"># may fall in failure mode (assignExit()?)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isProcessingInitialWIP</span>
            <span class="p">):</span>  <span class="c1"># if we are in the state of having initial wip no need to take an Entity</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currentEntity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEntity</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># find out if the initialWIP requires manual operations (manual/setup)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checkInitialOperationTypes</span><span class="p">()</span>
                <span class="c1"># calculate initial processing and setup times</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculateInitialOperationTimes</span><span class="p">()</span>
            <span class="c1"># TODO: the Machine receive the entity after the operator is available</span>
            <span class="c1">#     the canAcceptAndIsRequested method checks only in case of Load type of operation</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># # release a resource if the only operation type is Load</span>
            <span class="c1"># ===================================================================</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shouldYield</span><span class="p">(</span>
                <span class="n">operationTypes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Load&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Processing&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Setup&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;isOperated&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="p">):</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">())</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># # request a resource if it is not already assigned an Operator</span>
            <span class="c1"># ===================================================================</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shouldYield</span><span class="p">(</span>
                <span class="n">operationTypes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Setup&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Processing&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;isOperated&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operatorWaitTimeCurrentEntity</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorEnded</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorStarted</span>
                <span class="p">)</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># # # setup</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># if the distribution is Fixed and the mean is zero then yield not</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stpRng</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stpRng</span><span class="o">.</span><span class="n">distributionType</span> <span class="o">==</span> <span class="s2">&quot;Fixed&quot;</span><span class="p">):</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operation</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Setup&quot;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">endOperationActions</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Setup&quot;</span><span class="p">)</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># # # end setup</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># # release a resource at the end of setup</span>
            <span class="c1"># ===================================================================</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shouldYield</span><span class="p">(</span>
                <span class="n">operationTypes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Setup&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Load&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Processing&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
                <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;isOperated&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="p">):</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">())</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="o">.</span><span class="n">skillDict</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="o">.</span><span class="n">skillDict</span><span class="p">[</span><span class="s2">&quot;process&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s2">&quot;stationIdList&quot;</span><span class="p">,</span> <span class="p">[]</span>
                    <span class="p">):</span>
                        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">())</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># # request a resource if it is not already assigned an Operator</span>
            <span class="c1"># ===================================================================</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shouldYield</span><span class="p">(</span>
                <span class="n">operationTypes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Processing&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;isOperated&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operatorWaitTimeCurrentEntity</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorEnded</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeWaitForOperatorStarted</span>
                <span class="p">)</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># # # processing</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">operation</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Processing&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endOperationActions</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Processing&quot;</span><span class="p">)</span>

            <span class="c1"># wait for the Feature to commence</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectProperties</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;objectPropertyEnd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectPropertyEnd</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objectPropertyEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>

            <span class="c1"># Control and end of processing</span>
            <span class="n">activeObjectQueue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Res</span><span class="o">.</span><span class="n">users</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputTrace</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;Failed Process control&quot;</span><span class="p">)</span>
                <span class="c1"># send data to QuestDB</span>
                <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="p">:</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">),</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot; failed Process control&quot;</span><span class="p">}</span>
                    <span class="p">)</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">activeEntity</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Fail&quot;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">removeEntity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activeEntity</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">discards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activeEntity</span><span class="p">)</span>

                <span class="c1"># blocking starts</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isBlocked</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeLastBlockageStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>
                <span class="c1"># update the variables keeping track of Entity related attributes of the machine</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeLastEntityEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">nameLastEntityEnded</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">currentEntity</span><span class="o">.</span><span class="n">name</span>
                <span class="p">)</span>  <span class="c1"># this holds the name of the last entity that ended processing in Machine</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">completedJobs</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Machine completed one more Job# it will be used</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isProcessingInitialWIP</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="c1"># if there is a failure that depends on the working time of the Machine</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isWorkingOnTheLast</span><span class="p">:</span>
                    <span class="c1"># for the scheduled Object interruptions</span>
                    <span class="c1"># XXX add the SkilledOperatorRouter to this list and perform the signalling only once</span>
                    <span class="k">for</span> <span class="n">interruption</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">ObjectInterruptionList</span><span class="p">:</span>
                        <span class="c1"># if the objectInterruption is waiting for a a signal</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">interruption</span><span class="o">.</span><span class="n">victim</span> <span class="o">==</span> <span class="bp">self</span>
                            <span class="ow">and</span> <span class="n">interruption</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;endedLastProcessing&quot;</span><span class="p">]</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sendSignal</span><span class="p">(</span><span class="n">receiver</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endedLastProcessing</span><span class="p">)</span>
                            <span class="n">interruption</span><span class="o">.</span><span class="n">waitingSignal</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">isWorkingOnTheLast</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="c1"># set timeLastShiftEnded attribute so that if it is overtime working it is not counted as off-shift time</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptedBy</span> <span class="o">==</span> <span class="s2">&quot;ShiftScheduler&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">timeLastShiftEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputTrace</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;Succeeded Process control&quot;</span><span class="p">)</span>
                    <span class="c1"># send data to QuestDB</span>
                    <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="p">:</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">),</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot; succeeded Process control&quot;</span><span class="p">}</span>
                        <span class="p">)</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">activeEntity</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Success&quot;</span>

                <span class="c1"># blocking starts</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isBlocked</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeLastBlockageStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">printTrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getActiveObjectQueue</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">processEnd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objName</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">printTrace</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">processEnd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objName</span><span class="p">)</span>
                <span class="c1"># output to trace that the processing in the Machine self.objName ended</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outputTrace</span><span class="p">(</span>
                        <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="s2">&quot;Finished processing on &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="c1"># send Data to QuestDB</span>
                    <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="p">:</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">),</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot; finished processing&quot;</span><span class="p">}</span>
                        <span class="p">)</span>
                        <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>

                <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">:</span>
                    <span class="c1"># the just processed entity is added to the list of entities</span>
                    <span class="c1"># pending for the next processing</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">pendingEntities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># set the variable that flags an Entity is ready to be disposed</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">waitToDispose</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># update the variables keeping track of Entity related attributes of the machine</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeLastEntityEnded</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="p">)</span>  <span class="c1"># this holds the time that the last entity ended processing in Machine</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nameLastEntityEnded</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">currentEntity</span><span class="o">.</span><span class="n">name</span>
                <span class="p">)</span>  <span class="c1"># this holds the name of the last entity that ended processing in Machine</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">completedJobs</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Machine completed one more Job# it will be used</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isProcessingInitialWIP</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="c1"># if there is a failure that depends on the working time of the Machine</span>

                <span class="c1"># in case Machine just performed the last work before the scheduled maintenance signal the corresponding object</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isWorkingOnTheLast</span><span class="p">:</span>
                    <span class="c1"># for the scheduled Object interruptions</span>
                    <span class="c1"># XXX add the SkilledOperatorRouter to this list and perform the signalling only once</span>
                    <span class="k">for</span> <span class="n">interruption</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">ObjectInterruptionList</span><span class="p">:</span>
                        <span class="c1"># if the objectInterruption is waiting for a a signal</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">interruption</span><span class="o">.</span><span class="n">victim</span> <span class="o">==</span> <span class="bp">self</span>
                            <span class="ow">and</span> <span class="n">interruption</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;endedLastProcessing&quot;</span><span class="p">]</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sendSignal</span><span class="p">(</span><span class="n">receiver</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">endedLastProcessing</span><span class="p">)</span>
                            <span class="n">interruption</span><span class="o">.</span><span class="n">waitingSignal</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">isWorkingOnTheLast</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="c1"># set timeLastShiftEnded attribute so that if it is overtime working it is not counted as off-shift time</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptedBy</span> <span class="o">==</span> <span class="s2">&quot;ShiftScheduler&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">timeLastShiftEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>


            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># # # end of processing</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># # release resource after the end of processing</span>
            <span class="c1"># ===================================================================</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shouldYield</span><span class="p">(</span>
                <span class="n">operationTypes</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Processing&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;isInterrupted&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;isOperated&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
            <span class="p">):</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">())</span>

            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># # # disposing if not already emptied</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>
            <span class="c1"># ===================================================================</span>

            <span class="c1"># signal the receiver that the activeObject has something to dispose of</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalReceiver</span><span class="p">():</span>
                <span class="c1"># if there was no available receiver, get into blocking control</span>

                <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getActiveObjectQueue</span><span class="p">()):</span>
                        <span class="k">break</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;interruptionStart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;canDispose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;entityRemoved&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">timeLastBlockageStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>  <span class="c1"># blockage is starting</span>

                    <span class="c1"># wait the event canDispose, this means that the station can deliver the item to successor</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">printTrace</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">waitEvent</span><span class="o">=</span><span class="s2">&quot;(canDispose or interruption start)&quot;</span>
                    <span class="p">)</span>

                    <span class="n">receivedEvent</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">any_of</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canDispose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionStart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entityRemoved</span><span class="p">]</span>
                    <span class="p">)</span>

                    <span class="c1"># if there was interruption</span>
                    <span class="c1"># TODO not good implementation</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionStart</span> <span class="ow">in</span> <span class="n">receivedEvent</span><span class="p">:</span>
                        <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionStart</span><span class="o">.</span><span class="n">value</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                        <span class="p">),</span> <span class="s2">&quot;the interruption has not been processed on the time of activation&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interruptionStart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                        <span class="c1"># wait for the end of the interruption</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">interruptionActions</span><span class="p">()</span>  <span class="c1"># execute interruption actions</span>
                        <span class="c1"># loop until we reach at a state that there is no interruption</span>
                        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;interruptionEnd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canDeliverOnInterruption</span><span class="p">:</span>
                                <span class="n">receivedEvent</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span><span class="p">)</span>  <span class="c1"># interruptionEnd to be triggered by ObjectInterruption</span>
                            <span class="c1"># if the object canDeliverOnInterruption then it has to wait also for canDispose</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;canDispose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                                <span class="n">receivedEvent</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">any_of</span><span class="p">(</span>
                                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">canDispose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span><span class="p">]</span>
                                <span class="p">)</span>
                            <span class="c1"># if we have interruption end</span>
                            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span> <span class="ow">in</span> <span class="n">receivedEvent</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canDeliverOnInterruption</span>
                            <span class="p">):</span>
                                <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span><span class="o">.</span><span class="n">value</span>
                                <span class="k">assert</span> <span class="p">(</span>
                                    <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                                <span class="p">),</span> <span class="s2">&quot;the victim of the failure is not the object that received it&quot;</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">interruptionEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                                <span class="c1"># if there is no other interruption</span>
                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkIfActive</span><span class="p">():</span>
                                    <span class="c1"># Machine is back to blocked state</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">isBlocked</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">break</span>
                            <span class="c1"># else signalReceiver and continue</span>
                            <span class="k">elif</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">canDispose</span> <span class="ow">in</span> <span class="n">receivedEvent</span>
                            <span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">canDeliverOnInterruption</span><span class="p">:</span>
                                <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canDispose</span><span class="o">.</span><span class="n">value</span>
                                <span class="k">if</span> <span class="n">eventTime</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">canDispose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                                    <span class="k">continue</span>
                                <span class="k">assert</span> <span class="p">(</span>
                                    <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                                <span class="p">),</span> <span class="s2">&quot;canDispose signal is late&quot;</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">canDispose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">signalReceiver</span><span class="p">()</span>
                                <span class="k">continue</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">postInterruptionActions</span><span class="p">()</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalReceiver</span><span class="p">():</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">timeLastBlockageStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                            <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">continue</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canDispose</span> <span class="ow">in</span> <span class="n">receivedEvent</span><span class="p">:</span>
                        <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canDispose</span><span class="o">.</span><span class="n">value</span>
                        <span class="k">if</span> <span class="n">eventTime</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">canDispose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                            <span class="k">continue</span>
                        <span class="k">assert</span> <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="s2">&quot;canDispose signal is late&quot;</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">canDispose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                        <span class="c1"># try to signal a receiver, if successful then proceed to get an other entity</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">signalReceiver</span><span class="p">(</span><span class="n">transmitter</span><span class="p">):</span>
                            <span class="k">break</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">entityRemoved</span> <span class="ow">in</span> <span class="n">receivedEvent</span><span class="p">:</span>

                        <span class="n">transmitter</span><span class="p">,</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entityRemoved</span><span class="o">.</span><span class="n">value</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">printTrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">entityRemoved</span><span class="o">=</span><span class="n">eventTime</span><span class="p">)</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">eventTime</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                        <span class="p">),</span> <span class="s2">&quot;entityRemoved event activated earlier than received&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">waitEntityRemoval</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">entityRemoved</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">event</span><span class="p">()</span>
                        <span class="c1"># if while waiting (for a canDispose event) became free as the machines that follows emptied it, then proceed</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">haveToDispose</span><span class="p">():</span>
                            <span class="k">break</span></div>

<div class="viewcode-block" id="Machine.endOperationActions"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.endOperationActions">[docs]</a>    <span class="k">def</span> <span class="nf">endOperationActions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;actions to be performed after an operation (setup or processing)&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>

        <span class="n">activeObjectQueue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Res</span><span class="o">.</span><span class="n">users</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activeEntity</span> <span class="o">=</span> <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># set isProcessing to False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isProcessing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># the machine is currently performing no operation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentlyPerforming</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># add working time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalOperationTime</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeLastOperationStarted</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Processing&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">totalWorkingTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalOperationTime</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Setup&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">totalSetupTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalOperationTime</span>
            <span class="c1"># if there are task_ids defined for each step</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeEntity</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="c1"># if the setup is finished then record an exit time for the setup</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">activeEntity</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;exitTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
        <span class="c1"># reseting variables used by operation() process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">totalOperationTime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeLastOperationStarted</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># reseting flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shouldPreempt</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># reset the variables used to handle the interruptions timing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breakTime</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># update totalWorking time for operator and also print trace</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="p">:</span>
            <span class="n">operator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputTrace</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;ended a process in &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">objName</span><span class="p">)</span>

            <span class="c1"># send data to QuestDB</span>
            <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">),</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot; ended a process in &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">objName</span><span class="p">}</span>
                <span class="p">)</span>
                <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

            <span class="n">operator</span><span class="o">.</span><span class="n">totalWorkingTime</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">operator</span><span class="o">.</span><span class="n">timeLastOperationStarted</span>
            <span class="p">)</span>
        <span class="c1"># if the station has just concluded a processing turn then</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Processing&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectInterruptions</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Failure&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">deteriorationType</span> <span class="o">==</span> <span class="s2">&quot;working&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;victimEndsProcessing&quot;</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sendSignal</span><span class="p">(</span><span class="n">receiver</span><span class="o">=</span><span class="n">oi</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">oi</span><span class="o">.</span><span class="n">victimEndsProcessing</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectProperties</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;victimEndsProcessing&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sendSignal</span><span class="p">(</span><span class="n">receiver</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">victimEndsProcessing</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeEntity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discards</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activeEntity</span><span class="p">)</span></div>


<div class="viewcode-block" id="Machine.interruptionActions"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.interruptionActions">[docs]</a>    <span class="k">def</span> <span class="nf">interruptionActions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Processing&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;actions to be carried out when the processing of an Entity ends&quot;&quot;&quot;</span>

        <span class="c1"># if object was processing add the working time</span>
        <span class="c1"># only if object is not preempting though</span>
        <span class="c1"># in case of preemption endProcessingActions will be called</span>
        <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectInterruptions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Feature&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">deteriorationType</span> <span class="o">==</span> <span class="s2">&quot;working&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;victimIsInterrupted&quot;</span><span class="p">]:</span>
                        <span class="c1"># print(f&quot;{self.name} Sending victimIsInterrupted to {oi.name}&quot;)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sendSignal</span><span class="p">(</span><span class="n">receiver</span><span class="o">=</span><span class="n">oi</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">oi</span><span class="o">.</span><span class="n">victimIsInterrupted</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectProperties</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;victimIsInterrupted&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sendSignal</span><span class="p">(</span><span class="n">receiver</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">victimIsInterrupted</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isProcessing</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shouldPreempt</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">totalOperationTime</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeLastOperationStarted</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Processing&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">totalWorkingTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalOperationTime</span>
            <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Setup&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">totalSetupTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">totalOperationTime</span>
        <span class="c1"># if object was blocked add the working time</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isBlocked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addBlockage</span><span class="p">()</span>
        <span class="c1"># the machine is currently performing nothing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentlyPerforming</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">activeObjectQueue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Res</span><span class="o">.</span><span class="n">users</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">):</span>
            <span class="n">activeEntity</span> <span class="o">=</span> <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printTrace</span><span class="p">(</span><span class="n">activeEntity</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">interrupted</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">objName</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputTrace</span><span class="p">(</span>
                <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s2">&quot;Interrupted at &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">objName</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># send Data to QuestDB</span>
            <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">),</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Interrupted&quot;</span><span class="p">}</span>
                <span class="p">)</span>
                <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="c1"># recalculate the processing time left tinM</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeLastOperationStarted</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tinM</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tinM</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeLastOperationStarted</span><span class="p">),</span> <span class="mi">4</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">timeToEndCurrentOperation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tinM</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tinM</span><span class="p">,</span> <span class="mi">0</span>
                <span class="p">):</span>  <span class="c1"># sometimes the failure may happen exactly at the time that the processing would finish</span>
                    <span class="c1"># this may produce disagreement with the simul8 because in both SimPy and Simul8</span>
                    <span class="c1"># it seems to be random which happens 1st</span>
                    <span class="c1"># this should not appear often to stochastic models though where times are random</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tinM</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">interruption</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># start counting the down time at breatTime dummy variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breakTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>  <span class="c1"># dummy variable that the interruption happened</span>
        <span class="c1"># set isProcessing to False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isProcessing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># set isBlocked to False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isBlocked</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Machine.isInterrupted"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.isInterrupted">[docs]</a>    <span class="k">def</span> <span class="nf">isInterrupted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns true if the station is interrupted&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interruption</span></div>

<div class="viewcode-block" id="Machine.postInterruptionActions"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.postInterruptionActions">[docs]</a>    <span class="k">def</span> <span class="nf">postInterruptionActions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;actions to be carried out when the processing of an Entity ends&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">oi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectInterruptions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;Failure&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">deteriorationType</span> <span class="o">==</span> <span class="s2">&quot;working&quot;</span><span class="p">:</span>
                    <span class="c1"># print(f&quot;OI {oi.name} expects {oi.expectedSignals}&quot;)</span>
                    <span class="k">if</span> <span class="n">oi</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;victimResumesProcessing&quot;</span><span class="p">]:</span>
                        <span class="c1"># print(f&quot;{self.name} sending victimResumesProcessing to {oi.name}&quot;)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sendSignal</span><span class="p">(</span><span class="n">receiver</span><span class="o">=</span><span class="n">oi</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">oi</span><span class="o">.</span><span class="n">victimResumesProcessing</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objectProperties</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">expectedSignals</span><span class="p">[</span><span class="s2">&quot;victimResumesProcessing&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sendSignal</span><span class="p">(</span><span class="n">receiver</span><span class="o">=</span><span class="n">op</span><span class="p">,</span> <span class="n">signal</span><span class="o">=</span><span class="n">op</span><span class="o">.</span><span class="n">victimResumesProcessing</span><span class="p">)</span>

        <span class="n">activeObjectQueue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Res</span><span class="o">.</span><span class="n">users</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">):</span>
            <span class="n">activeEntity</span> <span class="o">=</span> <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># if the machine is empty signal giver</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signalGiver</span><span class="p">()</span>
        <span class="c1"># if the machine returns from an failure while processing an entity</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">waitToDispose</span><span class="p">:</span>
            <span class="c1"># use the timers to count the time that Machine is down and related</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timeLastFailureEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>  <span class="c1"># set the timeLastFailureEnded</span>
            <span class="c1"># output to trace that the Machine self.objName was passivated for the current failure time</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputTrace</span><span class="p">(</span>
                    <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="s2">&quot;passivated in &quot;</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">objName</span>
                    <span class="o">+</span> <span class="s2">&quot; for &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">breakTime</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="c1"># send Data to QuestDB</span>
                <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="p">:</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">),</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">activeObjectQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot; passivated in &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">objName</span> <span class="o">+</span> <span class="s2">&quot; for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">breakTime</span><span class="p">)}</span>
                    <span class="p">)</span>
                    <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="c1"># when a machine returns from failure while trying to deliver an entity</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># calculate the time the Machine was down while trying to dispose the current Entity,</span>
            <span class="c1"># and the total down time while on current Entity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">downTimeInTryingToReleaseCurrentEntity</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">breakTime</span>
            <span class="c1"># update the timeLastFailureEnded</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timeLastFailureEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
            <span class="c1"># reset the variable holding the time the failure happened</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">breakTime</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Machine.checkIfMachineIsUp"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.checkIfMachineIsUp">[docs]</a>    <span class="k">def</span> <span class="nf">checkIfMachineIsUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;checks if the machine is Up&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Up</span></div>

<div class="viewcode-block" id="Machine.canAccept"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.canAccept">[docs]</a>    <span class="k">def</span> <span class="nf">canAccept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callerObject</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        checks if the Machine can accept an entity.</span>
<span class="sd">        it checks also who called it and returns TRUE only to the predecessor that will give the entity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLocked</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">activeObjectQueue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Res</span><span class="o">.</span><span class="n">users</span>
        <span class="n">thecaller</span> <span class="o">=</span> <span class="n">callerObject</span>
        <span class="c1"># return True ONLY if the length of the activeOjbectQue is smaller than</span>
        <span class="c1"># the object capacity, and the callerObject is not None but the giverObject</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="nb">any</span><span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Load&quot;</span> <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">multOperationTypeList</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Setup&quot;</span> <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">multOperationTypeList</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="o">.</span><span class="n">checkIfResourceIsAvailable</span><span class="p">()</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkIfMachineIsUp</span><span class="p">()</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isInRouteOf</span><span class="p">(</span><span class="n">thecaller</span><span class="p">)</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">entryIsAssignedTo</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># the operator doesn&#39;t have to be present for the loading of the machine as the load operation</span>
            <span class="c1"># is not assigned to operators</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checkIfMachineIsUp</span><span class="p">()</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isInRouteOf</span><span class="p">(</span><span class="n">thecaller</span><span class="p">)</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">entryIsAssignedTo</span><span class="p">()</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Machine.canAcceptAndIsRequested"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.canAcceptAndIsRequested">[docs]</a>    <span class="k">def</span> <span class="nf">canAcceptAndIsRequested</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callerObject</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;checks if the Machine can accept an entity and there is an entity in some possible giver waiting for it.</span>
<span class="sd">        also updates the giver to the one that is to be taken&quot;&quot;&quot;</span>

        <span class="n">activeObjectQueue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Res</span><span class="o">.</span><span class="n">users</span>
        <span class="n">giverObject</span> <span class="o">=</span> <span class="n">callerObject</span>
        <span class="k">assert</span> <span class="n">giverObject</span><span class="p">,</span> <span class="s2">&quot;there must be a caller for canAcceptAndIsRequested&quot;</span>
        <span class="c1"># check if there is a place, the machine is up and the predecessor has an entity to dispose. if the machine has to compete</span>
        <span class="c1"># for an Operator that loads the entities onto it check if the predecessor if blocked by an other Machine. if not then the machine</span>
        <span class="c1"># has to block the predecessor giverObject to avoid conflicts with other competing machines</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="nb">any</span><span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Load&quot;</span> <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">multOperationTypeList</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">giverObject</span><span class="o">.</span><span class="n">haveToDispose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">checkOperator</span><span class="p">()</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkIfActive</span><span class="p">()</span>
                    <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span>
                <span class="p">):</span>
                    <span class="c1"># if the exit of the object is already assigned somewhere else, return false</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">giverObject</span><span class="o">.</span><span class="n">exitIsAssignedTo</span><span class="p">()</span>
                        <span class="ow">and</span> <span class="n">giverObject</span><span class="o">.</span><span class="n">exitIsAssignedTo</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span>
                    <span class="p">):</span>
                        <span class="k">return</span> <span class="kc">False</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># the operator performs no load and the entity is received by the machine while there is</span>
            <span class="c1"># no need for operators presence. The operator needs to be present only where the load Type</span>
            <span class="c1"># operation is assigned</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checkIfActive</span><span class="p">()</span>
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span>
                <span class="ow">and</span> <span class="n">giverObject</span><span class="o">.</span><span class="n">haveToDispose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="c1"># if the exit of the object is already assigned somewhere else, return false</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">giverObject</span><span class="o">.</span><span class="n">exitIsAssignedTo</span><span class="p">()</span>
                    <span class="ow">and</span> <span class="n">giverObject</span><span class="o">.</span><span class="n">exitIsAssignedTo</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Machine.isLoadRequested"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.isLoadRequested">[docs]</a>    <span class="k">def</span> <span class="nf">isLoadRequested</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return whether Load or setup Requested&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Load&quot;</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;Setup&quot;</span> <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">multOperationTypeList</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Machine.checkOperator"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.checkOperator">[docs]</a>    <span class="k">def</span> <span class="nf">checkOperator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callerObject</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;to be called by canAcceptAndIsRequested and check for the operator&quot;&quot;&quot;</span>

        <span class="n">mayProceed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="o">.</span><span class="n">operators</span><span class="p">:</span>
            <span class="c1"># flag notifying that there is operator assigned to the actievObject</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assignedOperator</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># the operators operating the station</span>
            <span class="n">operators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="o">.</span><span class="n">operators</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">operatorPool</span><span class="o">.</span><span class="n">checkIfResourceIsAvailable</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">operator</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">operators</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">checkIfResourceIsAvailable</span><span class="p">()</span>
                <span class="p">]:</span>
                    <span class="c1"># if there are operators available not assigned to the station then the station may proceed signalling the Router</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">operator</span><span class="o">.</span><span class="n">isAssignedTo</span><span class="p">():</span>
                        <span class="n">mayProceed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># if there are operators assigned to the station then proceed without invoking the Router</span>
                    <span class="k">elif</span> <span class="n">operator</span><span class="o">.</span><span class="n">isAssignedTo</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assignedOperator</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
            <span class="k">return</span> <span class="n">mayProceed</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignedOperator</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Machine.getEntity"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.getEntity">[docs]</a>    <span class="k">def</span> <span class="nf">getEntity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;get an entity from the giver&quot;&quot;&quot;</span>

        <span class="n">activeEntity</span> <span class="o">=</span> <span class="n">CoreObject</span><span class="o">.</span><span class="n">getEntity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># run the default method</span>
        <span class="c1"># update the entity attribute of the operator&#39;s schedule</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">activeEntity</span>
        <span class="c1"># after the machine receives an entity, it must be removed from the pendingEntities list</span>
        <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>

        <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">activeEntity</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">pendingEntities</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">pendingEntities</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">activeEntity</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">activeEntity</span></div>

<div class="viewcode-block" id="Machine.removeEntity"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.removeEntity">[docs]</a>    <span class="k">def</span> <span class="nf">removeEntity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;removes an entity from the Machine&quot;&quot;&quot;</span>

        <span class="n">activeEntity</span> <span class="o">=</span> <span class="n">CoreObject</span><span class="o">.</span><span class="n">removeEntity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span>  <span class="c1"># run the default method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">waitToDispose</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># update the waitToDispose flag</span>
        <span class="c1"># if the Machine canAccept then signal a giver</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canAccept</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printTrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">attemptSignalGiver</span><span class="o">=</span><span class="s2">&quot;(removeEntity)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">signalGiver</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">activeEntity</span></div>

<div class="viewcode-block" id="Machine.haveToDispose"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.haveToDispose">[docs]</a>    <span class="k">def</span> <span class="nf">haveToDispose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callerObject</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;checks if the Machine can dispose an entity to the following object&quot;&quot;&quot;</span>

        <span class="n">activeObjectQueue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Res</span><span class="o">.</span><span class="n">users</span>
        <span class="c1"># if we have only one successor just check if machine waits to dispose and also is up</span>
        <span class="c1"># this is done to achieve better (cpu) processing time</span>
        <span class="k">if</span> <span class="n">callerObject</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">waitToDispose</span>
                <span class="ow">and</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">canDeliverOnInterruption</span>
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeLastEntityEnded</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkIfActive</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">thecaller</span> <span class="o">=</span> <span class="n">callerObject</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">activeObjectQueue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">waitToDispose</span>
            <span class="ow">and</span> <span class="n">thecaller</span><span class="o">.</span><span class="n">isInRouteOf</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canDeliverOnInterruption</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeLastEntityEnded</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkIfActive</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Machine.canDeliver"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.canDeliver">[docs]</a>    <span class="k">def</span> <span class="nf">canDeliver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;checks whether the entity can proceed to a successor object&quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isInActiveQueue</span><span class="p">(</span><span class="n">entity</span><span class="p">),</span> <span class="p">(</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot; not in the internalQueue of&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="p">)</span>
        <span class="n">activeEntity</span> <span class="o">=</span> <span class="n">entity</span>

        <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>

        <span class="n">router</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># if the entity is in a machines who&#39;s broker waits for operator then</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">router</span><span class="o">.</span><span class="n">pendingMachines</span><span class="p">:</span>
            <span class="n">activeEntity</span><span class="o">.</span><span class="n">proceed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">activeEntity</span><span class="o">.</span><span class="n">candidateReceivers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Machine.requestOperator"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.requestOperator">[docs]</a>    <span class="k">def</span> <span class="nf">requestOperator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;prepare the machine to be operated&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">invokeType</span> <span class="o">=</span> <span class="s2">&quot;request&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">invoke</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toBeOperated</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Machine.releaseOperator"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.releaseOperator">[docs]</a>    <span class="k">def</span> <span class="nf">releaseOperator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;prepare the machine to be released&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>
        <span class="c1"># this checks if the operator is working on the last element.</span>
        <span class="c1"># If yes the time that he was set off-shift should be updated</span>
        <span class="n">operator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span>
        <span class="n">station</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">station</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">station</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">CoreObject</span><span class="p">):</span>
                <span class="n">operator</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;exitTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">operator</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;station&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;off-shift&quot;</span><span class="p">,</span>
                <span class="s2">&quot;on-break&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="n">operator</span><span class="o">.</span><span class="n">schedule</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;exitTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
        <span class="c1"># if the operator becomes unavailable</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="o">.</span><span class="n">onShift</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="o">.</span><span class="n">onBreak</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="o">.</span><span class="n">onShift</span><span class="p">:</span>
                <span class="n">operator</span><span class="o">.</span><span class="n">timeLastShiftEnded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentOperator</span><span class="o">.</span><span class="n">onBreak</span><span class="p">:</span>
                <span class="n">operator</span><span class="o">.</span><span class="n">timeLastBreakStarted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
            <span class="n">operator</span><span class="o">.</span><span class="n">unAssign</span><span class="p">()</span>  <span class="c1"># set the flag operatorAssignedTo to None</span>
            <span class="n">operator</span><span class="o">.</span><span class="n">workingStation</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">operator</span><span class="o">.</span><span class="n">operatorDedicatedTo</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toBeOperated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputTrace</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;Left &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
            <span class="c1"># send Data to QuestDB</span>
            <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">),</span>
                             <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot; left &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)}</span>
                <span class="p">)</span>
                <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="c1"># XXX in case of skilled operators which stay at the same station should that change</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">operator</span><span class="o">.</span><span class="n">operatorDedicatedTo</span> <span class="o">==</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">operator</span><span class="o">.</span><span class="n">unAssign</span><span class="p">()</span>  <span class="c1"># set the flag operatorAssignedTo to None</span>
            <span class="n">operator</span><span class="o">.</span><span class="n">workingStation</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputTrace</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;Left &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
            <span class="c1"># send Data to QuestDB</span>
            <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="p">),</span>
                             <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">operator</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot; left &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)}</span>
                <span class="p">)</span>
                <span class="n">G</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="c1"># if the Router is expecting for signal send it</span>
            <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>
            <span class="kn">from</span> <span class="nn">manpy.simulation.SkilledOperatorRouter</span> <span class="kn">import</span> <span class="n">SkilledRouter</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">toBeOperated</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">SkilledRouter</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">expectedFinishSignals</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">expectedFinishSignalsDict</span><span class="p">:</span>
                        <span class="n">signal</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">expectedFinishSignalsDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sendSignal</span><span class="p">(</span><span class="n">receiver</span><span class="o">=</span><span class="n">G</span><span class="o">.</span><span class="n">RouterList</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">signal</span><span class="o">=</span><span class="n">signal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">invokeType</span> <span class="o">=</span> <span class="s2">&quot;release&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">broker</span><span class="o">.</span><span class="n">invoke</span><span class="p">()</span></div>

<div class="viewcode-block" id="Machine.isOperated"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.isOperated">[docs]</a>    <span class="k">def</span> <span class="nf">isOperated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;check if the machine is currently operated by an operator&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">toBeOperated</span></div>

<div class="viewcode-block" id="Machine.outputResultsJSON"><a class="viewcode-back" href="../../../../deprecated_core_alternative_order.html#manpy.simulation.core.Machine.Machine.outputResultsJSON">[docs]</a>    <span class="k">def</span> <span class="nf">outputResultsJSON</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;outputs results to JSON File&quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">manpy.simulation.core.Globals</span> <span class="kn">import</span> <span class="n">G</span>

        <span class="n">json</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;_class&quot;</span><span class="p">:</span> <span class="s2">&quot;manpy.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span><span class="p">,</span>
            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="p">}</span>
        <span class="n">json</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;failure_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Failure</span>
        <span class="n">json</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;working_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Working</span>
        <span class="n">json</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;blockage_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Blockage</span>
        <span class="n">json</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;waiting_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Waiting</span>
        <span class="n">json</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;off_shift_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OffShift</span>
        <span class="n">json</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;setup_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SettingUp</span>
        <span class="n">json</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;loading_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Loading</span>
        <span class="n">json</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="s2">&quot;break_ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnBreak</span>

        <span class="n">G</span><span class="o">.</span><span class="n">outputJSON</span><span class="p">[</span><span class="s2">&quot;elementList&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">json</span><span class="p">)</span></div></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, AImotion Bavaria
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script src="../../../../_static/scripts/furo.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    </body>
</html>